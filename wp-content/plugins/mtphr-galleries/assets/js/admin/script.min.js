jQuery(document).ready(function($){function e(){$(".mtphr-galleries-add-external").slideUp(function(){$(".mtphr-galleries-add-external-input input").val(""),$(".mtphr-galleries-add-external-submit a").removeAttr("type"),$(".mtphr-galleries-add-external-submit").find("span, i").hide()})}function t(){$(".mtphr-galleries-thumbnails").find(".mtphr-gallery-thumbnail").each(function(e){$(this).find("input, select").each(function(){var t=$(this).attr("data-prefix"),r=$(this).attr("data-param");$(this).attr("name",t+"["+e+"]["+r+"]")})})}$("#mtphr-galleries-page-tabs").tabs({active:0}),$(".mtphr-galleries-thumbnails").sortable({items:".mtphr-gallery-thumbnail",helper:function(e,t){var r=t.children(),a=t.clone();return a.children().each(function(e){$(this).width(r.eq(e).width()),$(this).height(r.eq(e).height())}),a},update:function(){t()}}),$(".mtphr-gallery-thumbnail-delete").live("click",function(e){e.preventDefault();var t=$(this).parents(".mtphr-galleries-thumbnails"),r=t.siblings(".mtphr-galleries-add-buttons"),a=t.data("single");$(this).parents(".mtphr-gallery-thumbnail").fadeOut(function(){$(this).remove(),a&&r.show()})}),$(".mtphr-galleries-add-image").click(function(r){r.preventDefault(),e();var a=$(this).parent(),i=a.siblings(".mtphr-galleries-thumbnails").find("tr"),l=$(this).data("prefix"),s=$(this).data("single"),n;return n?void n.open():(n=wp.media({title:mtphr_galleries_vars.img_title,button:{text:mtphr_galleries_vars.img_button,size:"small"},multiple:!s,library:{type:"image"}}),n.on("select",function(){s&&a.hide();var e=n.state().get("selection").toJSON();if(e.length>0){var r={action:"mtphr_gallery_thumb_ajax",type:"field",name_resources:l,attachments:e,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,r,function(e){i.append(e),t()})}}),n.open(),!1)}),$(".mtphr-galleries-add-video").click(function(r){r.preventDefault(),e();var a=$(this).parent(),i=a.siblings(".mtphr-galleries-thumbnails").find("tr"),l=$(this).data("prefix"),s=$(this).data("single"),n;return n?void n.open():(n=wp.media({title:mtphr_galleries_vars.video_title,button:{text:mtphr_galleries_vars.video_button,size:"small"},multiple:!s,library:{type:"video"}}),n.on("select",function(){s&&a.hide();var e=n.state().get("selection").toJSON();if(e.length>0){var r={action:"mtphr_gallery_thumb_ajax",type:"field",name_resources:l,attachments:e,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,r,function(e){i.append(e),t()})}}),n.open(),!1)}),$(".mtphr-galleries-add-audio").click(function(r){r.preventDefault(),e();var a=$(this).parent(),i=a.siblings(".mtphr-galleries-thumbnails").find("tr"),l=$(this).data("prefix"),s=$(this).data("single"),n;return n?void n.open():(n=wp.media({title:mtphr_galleries_vars.audio_title,button:{text:mtphr_galleries_vars.audio_button,size:"small"},multiple:!s,library:{type:"audio"}}),n.on("select",function(){s&&a.hide();var e=n.state().get("selection").toJSON();if(e.length>0){var r={action:"mtphr_gallery_thumb_ajax",type:"field",name_resources:l,attachments:e,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,r,function(e){i.append(e),t()})}}),n.open(),!1)}),$(".mtphr-galleries-add-external-submit a").click(function(r){r.preventDefault();var a=$(this).parents(".mtphr-galleries-add-external"),i=a.siblings(".mtphr-galleries-add-buttons"),l=a.siblings(".mtphr-galleries-thumbnails").find("tr"),s=$(this).attr("type"),n=$(this).siblings(".spinner"),p=$(this).siblings(".mtphr-galleries-add-external-error"),h=$(this).parent().prev().children("input").val(),u=$(this).attr("href"),m=$(this).data("prefix"),o=$(this).data("single");u=u.substr(1,u.length),p.hide(),n.show(),n.css("visibility","visible"),o&&i.hide();var d={action:"mtphr_gallery_external_thumb_ajax",type:s,value:h,parent:u,name_resources:m,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,d,function(r){n.hide(),"error"===r?p.css("display","inline-block"):(l.append(r),e(),t())})}),$(".mtphr-galleries-update-poster-button").live("click",function(e){e.preventDefault();var r=$(this).parents(".mtphr-galleries-admin-thumb"),a=r.siblings(".mtphr-galleries-poster"),i=$(this).children(".mtphr-gallery-spinner-small"),l=r.siblings(".mtphr-galleries-type").val(),s=r.siblings(".mtphr-galleries-id").val(),n=$(this).attr("href");n=n.substr(1,n.length),i.show();var p={action:"mtphr_gallery_create_external_thumb_ajax",type:l,value:s,poster:a.val(),parent:n,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,p,function(e){if(e){var l=$(e);a.val(l.attr("alt")),r.html(l),t(),i.hide()}})}),$(".mtphr-galleries-add-youtube").click(function(t){t.preventDefault(),e();var r=$(this).parent().siblings(".mtphr-galleries-add-external"),a=r.find(".mtphr-galleries-add-external-title"),i=r.find(".mtphr-galleries-add-external-input input"),l=r.find(".mtphr-galleries-add-external-submit").children("a");a.text(mtphr_galleries_vars.youtube_input_title),l.attr("type","youtube"),i.focus(),r.slideDown(function(){i.focus()})}),$(".mtphr-galleries-add-vimeo").click(function(t){t.preventDefault(),e();var r=$(this).parent().siblings(".mtphr-galleries-add-external"),a=r.find(".mtphr-galleries-add-external-title"),i=r.find(".mtphr-galleries-add-external-input input"),l=r.find(".mtphr-galleries-add-external-submit").children("a");a.text(mtphr_galleries_vars.vimeo_input_title),l.attr("type","vimeo"),r.slideDown(function(){i.focus()})}),$(".mtphr-galleries-poster-button.add-poster").live("click",function(e){e.preventDefault();var t=$(this).parents(".mtphr-galleries-admin-thumb"),r=t.siblings(".mtphr-galleries-poster"),a=$(this).attr("data-prefix"),i;return i?void i.open():(i=wp.media({title:mtphr_galleries_vars.poster_title,button:{text:mtphr_galleries_vars.poster_button,size:"small"},multiple:!1,library:{type:"image"}}),i.on("select",function(){var e=i.state().get("selection").toJSON();if(e.length>0){r.val(e[0].id),$(this).removeClass("add-poster").addClass("remove-poster");var l={action:"mtphr_gallery_thumb_ajax",type:"thumbnail",name_resources:a,attachments:e,security:mtphr_galleries_vars.security};jQuery.post(ajaxurl,l,function(e){var r=e;r+='<a class="mtphr-galleries-poster-button remove-poster" href="#">'+mtphr_galleries_vars.remove_poster+"</a>",t.html(r)})}}),i.open(),!1)}),$(".mtphr-galleries-poster-button.remove-poster").live("click",function(e){e.preventDefault();var t=$(this).parents(".mtphr-galleries-admin-thumb"),r=t.siblings(".mtphr-galleries-poster"),a=t.siblings(".mtphr-galleries-type").val();$(this).removeClass("remove-poster").addClass("add-poster"),r.val("");var i='<i class="mtphr-galleries-icon-'+a+'"></i>';i+='<a class="mtphr-galleries-poster-button add-poster" href="#">'+mtphr_galleries_vars.add_poster+"</a>",t.html(i)})});